<!-- Probably move the stylesheet to you layout. Also make sure you include the javascript. -->
<%= stylesheet_link_tag "event_calendar" %>

<script>
function make_hidden( name, value, formid ){
    var q = document.createElement('input');
    q.type = 'hidden';
    q.name = name;
    q.value = value;
    if (formid){
      var elm = document.getElementById(formid);
      elm.appendChild(q);
    }
    else{
      document.forms[0].appendChild(q);
    }
    // if (formname){ document.forms[formname].appendChild(q); }
    // else{ document.forms[0].appendChild(q); }
}

function delete_hidden( name, value, formname ){
    var dom_obj_array = window.document.getElementsByName(name);
    for (var i=0; i<dom_obj_array.length; i++){
        if ( dom_obj_array[i].value === value ){
            element = dom_obj_array[i];
            element.parentNode.removeChild(element);
        }
    }
}
</script>

<script>
function  selectedDates(){

  $.each(dates, function(index, value){
    make_hidden('selected[]', value, 'new_event');
  });
  return true;
}
</script>
<style>
  .selected a{
    background: orange !important
  }
</style>

<div style="display:inline-flex", id="table">
<br>
<br>

<table bordercolorlight="white", height = 1000, margin = 20>
<head>
<caption>h</caption>
  <thead>
  <tr bgcolor="green">
    <tr height=65><th></th></tr>
    </tr>
  </thead>
  <tbody>
    <tr><th style="line-height:3.2" align="right"><a>1:00</a></tr>
    <tr><th style="line-height:0" align="right"><a>2:00</a></tr>
    <tr><th style="line-height:3.0" align="right"><a>3:00</a></td></tr>
    <tr class="odd"><th style="line-height:0" align="right"><a>4:00</a></td></tr>
    <tr><th style="line-height:3.0" align="right"><a>5:00</a></td></tr>
    <tr><th style="line-height:0" align="right"><a>6:00</a></td></tr>
    <tr class="odd"><th style="line-height:3.0" align="right"><a>7:00</a></td></tr>
    <tr><th style="line-height:0" align="right"><a>8:00</a></td></tr>
    <tr class="odd"><th style="line-height:3.0" align="right"><a>9:00</a></td></tr>
    <tr><th style="line-height:0"><a>10:00</a></td></tr>
    <tr><th style="line-height:3.0"><a>11:00</a></td></tr>
    <tr class="odd"><th style="line-height:0"><a>12:00</a></td></tr>
    <tr><th style="line-height:3.0"><a>13:00</a></td></tr>
    <tr class="odd"><th style="line-height:0"><a>14:00</a></td></tr>
    <tr><th style="line-height:3.0"><a>15:00</a></td></tr>
    <tr><th style="line-height:0"><a>16:00</a></td></tr>
    <tr class="odd"><th style="line-height:3.0"><a>17:00</a></td></tr>
    <tr><th style="line-height:0"><a>18:00</a></td></tr>
    <tr class="odd"><th style="line-height:3.0"><a>19:00</a></td></tr>
    <tr><th style="line-height:0"><a>20:00</a></td></tr>
    <tr><th style="line-height:3.0"><a>21:00</a></td></tr>
    <tr class="odd"><th style="line-height:0"><a>22:00</a></td></tr>
    <tr><th style="line-height:3.0"><a>23:00</a></td></tr>
    <tr class="odd"><th style="line-height:0"><a>24:00</a></td></tr>
  </tbody>
  </head>
</table>

<table border width=160, height=1000 >
<head>
  <caption><%= I18n.localize(Date.today, :format => :short) %></caption>
  <thead>
  <tr>
    <tr height = "38"><th>予定</th><th>場所</th><th>相手</th></tr>
    </tr>
  </thead>
  <tbody>
    <tr height = "38"><td><a href="index"><%= if !@today[0].nil? then @today[0].name end %></a></td><td><%= if !@today[0].nil? then @today[0].place else "\n" end %></td><th></th>
    <tr class="odd"  height = "38"><td><a href="index"><%= if !@today[1].nil? then @today[1].name end %></a></td><td><%= if !@today[1].nil? then @today[1].place end %></td></tr>
    <tr height = "40"><td><a href="index"><%= if !@today[2].nil? then @today[2].name end %></a></td><td><%= if !@today[2].nil? then @today[2].place end %></td></tr>
    <tr class="odd" height = "38"><td><a href="index"><%= if !@today[3].nil? then @today[3].name end %></a></td><td><%= if !@today[3].nil? then @today[3].place end %></td></tr>
    <tr height = "38"><td><a href="index"><%= if !@today[4].nil? then @today[4].name end %></a></td><td><%= if !@today[4].nil? then @today[4].place end %></td></tr>
    <tr height = "38"><td><a href="index"><%= if !@today[5].nil? then @today[5].name end %></a></td><td><%= if !@today[5].nil? then @today[5].place end %></td></tr>
    <tr height = "38" class="odd"><td><a href="index"><%= if !@today[6].nil? then @today[6].name end %></a></td><td><%= if !@today[6].nil? then @today[6].place end %></td></tr>
    <tr height = "38"><td><a href="index"><%= if !@today[7].nil? then @today[7].name end %></a></td><td><%= if !@today[7].nil? then @today[7].place end %></td></tr>
    <tr class="odd" height = "38"><td><a href="index"><%= if !@today[8].nil? then @today[8].name end %></a></td><td><%= if !@today[8].nil? then @today[8].place end %></td></tr>
    <tr height = "38"><td><a href="index"><%= if !@today[9].nil? then @today[9].name end %></a></td><td><%= if !@today[9].nil? then @today[9].place end %></td></tr>
    <tr height = "38"><td><a href="index"><%= if !@today[10].nil? then @today[10].name end %></a></td><td><%= if !@today[10].nil? then @today[10].place end %></td></tr>
    <tr class="odd" height = "38"><td><a href="index"><%= if !@today[11].nil? then @today[11].name end %></a></td><td><%= if !@today[11].nil? then @today[11].place end %></td></tr>
    <tr height = "38"><td><a href="index"></a><%= if !@today[12].nil? then @today[12].name end %></td><td><%= if !@today[12].nil? then @today[12].place end %></td></tr>
    <tr class="odd" height = "38"><td><a href="index"><%= if !@today[13].nil? then @today[13].name end %></a></td><td><%= if !@today[13].nil? then @today[13].place end %></td></tr>
    <tr height = "38"><td><a href="index"><%= if !@today[14].nil? then @today[14].name end %></a></td><td><%= if !@today[14].nil? then @today[14].place end %></td></tr>
    <tr height = "38"><td><a href="index"><%= if !@today[15].nil? then @today[15].name end %></a></td><td><%= if !@today[15].nil? then @today[15].place end %></td></tr>
    <tr class="odd" height = "38"><td><a href="index"><%= if !@today[16].nil? then @today[16].name end %></a></td><td><%= if !@today[16].nil? then @today[16].place end %></td></tr>
    <tr height = "38"><td><a href="index"><%= if !@today[17].nil? then @today[17].name end %></a></td><td><%= if !@today[17].nil? then @today[17].place end %></td></tr>
    <tr class="odd" height = "38"><td><a href="index"><%= if !@today[18].nil? then @today[18].name end %></a></td><td><%= if !@today[18].nil? then @today[18].place end %></td></tr>
    <tr height = "38"><td><a href="index"><%= if !@today[19].nil? then @today[19].name end %></a></td><td><%= if !@today[19].nil? then @today[19].place end %></td></tr>
    <tr height = "38"><td><a href="index"><%= if !@today[20].nil? then @today[20].name end %></a></td><td><%= if !@today[20].nil? then @today[20].place end %></td></tr>
    <tr class="odd" height = "38"><td><a href="index"><%= if !@today[21].nil? then @today[21].name end %></a></td><td><%= if !@today[21].nil? then @today[21].place end %></td></tr>
    <tr height = "38"><td><a href="index"><%= if !@today[22].nil? then @today[22].name end %></a></td><td><%= if !@today[22].nil? then @today[22].place end %></td></tr>
    <tr class="odd" height = "38"><td><a href="index"><%= if !@today[23].nil? then @today[23].name end %></a></td><td><%= if !@today[23].nil? then @today[23].place end %></td></tr>
  </tbody>
  </head>
</table>

<table border, width=160, height=1000>

<head>
  <caption><%= I18n.localize(Date.tomorrow, :format => :short) %></caption>
  <thead>
  <tr>
    <tr><th>予定</th><th>場所</th><th>相手</th></tr>
    </tr>
  </thead>
  <tbody>
  <% if @event.category == 1 %>
    <tr bgcolor="green"><td><a href="index">1001</a></td><td><%= @event.name %></td><th></th>
    <% elsif @event.category == 2 %>
      <tr bgcolor="blue"><td><a href="index">1001</a></td><td><%= @event.name %></td><th></th>
    <% elsif @event.category == 3 %>
      <tr bgcolor="red"><td><a href="index">1001</a></td><td><%= @event.name %></td><th></th>
    <% elsif @event.category == 4 %>
      <tr bgcolor="yellow"><td><a href="index">1001</a></td><td><%= @event.name %></td><th></th>
    <% elsif @event.category == 5 %>
      <tr bgcolor="magenta"><td><a href="index">1001</a></td><td><%= @event.name %></td><th></th>
      <% else %>
    <tr><td><a href="index">1001</a></td><td><%= @event.name %></td><th></th></tr>
    <% end %>

    <tr class="odd"><td><a href="index">2001</a></td><td>bbbb</td></tr>
    <tr><td><a href="index">3001</a></td><td>cccc</td></tr>
    <tr class="odd"><td><a href="index">4001</a></td><td>dddd</td></tr>
    <tr><td><a href="index">5001</a></td><td>eeee</td></tr>
    <tr><td><a href="index">1001</a></td><td>aaaa</td></tr>
    <tr class="odd"><td><a href="index">2001</a></td><td>bbbb</td></tr>
    <tr><td><a href="index">3001</a></td><td>cccc</td></tr>
    <tr class="odd"><td><a href="index">4001</a></td><td>ddd</td></tr>
    <tr><td><a href="index">5001</a></td><td>eeee</td></tr>
    <tr><td><a href="index">1001</a></td><td>aaaa</td></tr>
    <tr class="odd"><td><a href="index">2001</a></td><td>bbbb</td></tr>
    <tr><td><a href="index">3001</a></td><td>cccc</td></tr>
    <tr class="odd"><td><a href="index">4001</a></td><td>dddd</td></tr>
    <tr><td><a href="index">5001</a></td><td>eeee</td></tr>
    <tr><td><a href="index">1001</a></td><td>aaaa</td></tr>
    <tr class="odd"><td><a href="index">2001</a></td><td>bbbb</td></tr>
    <tr><td><a href="index">3001</a></td><td>cccc</td></tr>
    <tr class="odd"><td><a href="index">4001</a></td><td>dddd</td></tr>
    <tr><td><a href="index">5001</a></td><td>eeee</td></tr>
    <tr><td><a href="index">1001</a></td><td>aaaa</td></tr>
    <tr class="odd"><td><a href="index">2001</a></td><td>bbbb</td></tr>
    <tr><td><a href="index">3001</a></td><td>cccc</td></tr>
    <tr class="odd"><td><a href="index">4001</a></td><td>dddd</td></tr>
  </tbody>
  </head>
</table>

<br>
</div>
<%#= javascript_include_tag "event_calendar" %>
<div id="group">
<div id="calendar">
<%#= link_to("newold", :controller => "events", :action => "new") %>
<%= link_to '新規', '#', class: 'newopen' %>
<%= raw(event_calendar) %>
</div>
<div id=detail><%= render partial: 'detail', locals:{event: @event, id: params[:id]} %></div>
<div id=todolist><%= render partial: 'todolist', locals:{todos: @todos, new_todo: @new_todo} %></div>
</div>
<div id="newmodal" style="display:none;">
<%= form_for @new_event, url: '/event/create', :html => {:onsubmit => "return selectedDates()"} do |f| %>
    <%= f.hidden_field :id %>
    <p><b><%= f.label :name, "タイトル" %></b><br>
    <%= f.text_field :name %></p>
    <p><b><%= f.label :start_at, "開始時刻" %></b><br>
      <%= raw sprintf(f.datetime_select(:start_at, :default => Time.now.in_time_zone('Tokyo'), :use_month_numbers => true, :date_separator => '%s', :datetime_separator => ' %s', :time_separator => '%s'),'年 ','月 ','日 ','時 ')+'分'%></p>
      <p><b><%= f.label :end_at,"終了時刻" %></b><br>
      <%= raw sprintf(f.datetime_select(:end_at, :default => Time.now.in_time_zone('Tokyo'), :use_month_numbers => true, :date_separator => '%s', :datetime_separator => ' %s', :time_separator => '%s'),'年 ','月 ','日 ','時 ')+'分'%></p>
    <p><b><%= f.label :place, "場所" %></b><br>
    <%= f.text_field :place %></p>
    <p><b><%= f.label :person, "相手" %></b><br>
    <%= f.text_field :person %></p>
    <p><b><%= f.label :baggage, "持ち物" %></b><br>
    <%= f.text_field :baggage %></p>
    <p><b><%= f.label :category, "カテゴリ"%></b><br>
    <%= f.select :category, [["遊び", 1],["研究室", 2],["バイト", 3],["授業", 4],["その他",0]] %></p>
    <div >
      <p><b>繰り返し設定</b><br>
      <%= f.check_box :mon %>
      <%= f.label :mon, "月 " %>
      <%= f.check_box :tue %>
      <%= f.label :tue, "火 " %>
      <%= f.check_box :wed %>
      <%= f.label :wed, "水 " %>
      <%= f.check_box :thu %>
      <%= f.label :thu, "木 " %>
      <%= f.check_box :fri %>
      <%= f.label :fri, "金 " %>
      <%= f.check_box :sat %>
      <%= f.label :sat, "土 " %>
      <%= f.check_box :sun %>
      <%= f.label :sun, "日 " %><br>
      <%= f.label :deadline, "繰り返し終了" %><br>
      <%= raw sprintf(f.date_select(:deadline, :default => Time.now.in_time_zone('Tokyo'), :use_month_numbers => true, :date_separator => '%s'),'年 ','月 ',)+'日'%></p>
    </div>
    <p><b><a id="button" href="javascript:;">一括登録</a></b></p>
    <p><div id="addMonth"></div></p>
    <%= f.submit "送信"%>
<% end %>
</div>

<div id="editmodal" style="display:none;">
<%#= form_for@event, url: event_path do |f| %>
<%# @event = @new_event %>
<%= form_for @event, url: '/event/create' do |f| %>
    <%= f.hidden_field :id %>
    <p><b><%= f.label :name, "タイトル" %></b><br>
    <%= f.text_field :name %></p>
    <p><b><%= f.label :start_at, "開始時刻"%></b><br>
    <%= raw sprintf(f.datetime_select(:start_at, :default => Time.now.in_time_zone('Tokyo'), :use_month_numbers => true, :date_separator => '%s', :datetime_separator => ' %s', :time_separator => '%s'),'年 ','月 ','日 ','時 ')+'分'%></p>
    <p><b><%= f.label :end_at,"終了時刻" %></b><br>
    <%= raw sprintf(f.datetime_select(:end_at, :default => Time.now.in_time_zone('Tokyo'), :use_month_numbers => true, :date_separator => '%s', :datetime_separator => ' %s', :time_separator => '%s'),'年 ','月 ','日 ','時 ')+'分'%></p>
    <p><b><%= f.label :place, "場所" %></b><br>
    <%= f.text_field :place %></p>
    <p><b><%= f.label :person, "相手" %></b><br>
    <%= f.text_field :person %></p>
    <p><b><%= f.label :baggage, "持ち物" %></b><br>
    <%= f.text_field :baggage %></p>
    <p><b><%= f.label :category, "カテゴリ"%></b><br>
    <%= f.select :category, [["遊び", 1],["研究室", 2],["バイト", 3],["授業", 4],["その他", 0]] %></p>
    <%= f.submit "送信", name:"update_button" %>
    <%= f.submit "削除", name:"delete_button", data:{:confirm => "本当に削除しますか?"} %>
    <%= f.submit "以降の繰り返し予定を削除", name:"delete_all_button", data:{:confirm => "本当に削除しますか?"} %>
<% end %>
</div>


<!-- <script type="text/javascript" src="js/jquery-1.5.1.min.js"></script>
<script type="text/javascript" src="js/jquery-ui-1.8.11.custom.min.js"></script>
<script type="text/javascript"> -->
<script>
  $(function() {
    $('.newopen').click(function() {
      $('#newmodal').dialog({
        modal: true,
        resizable: true,
        width: 'auto',
        title: '新規作成'
      });
    });
    $('.editopen').click(function() {
      $('#editmodal').dialog({
        modal: true,
        resizable: true,
        width: 'auto',
        title: '編集'
      });
    });
  });
</script>

<%#= javascript_include_tag "application" %>



<script>
// Namespace

// var sel = document.getElementById('addMonth');
var PRJ = PRJ || {};
dates = [];

(function($, d, ns){
    'use strict';
 
    function pad2(arg) {
        var tmp = '00' + arg;
 
        return tmp.slice(-2, tmp.length);
    }
 
    var addMonth = {
        c: {
            done: '<a href="javascript:;" id="done">非表示</a>'
        },
        initialize: function() {
            this.$elm = $('#addMonth');
            this.$elm.datepicker({
                onSelect: $.proxy(this.handleSelect, this),
                beforeShowDay: $.proxy(this.beforeShowDay, this),
                dateFormat: 'yy/mm/dd'
            }).hide();
            this.$done = $(this.c.done);
            this.$done.click($.proxy(this.handleDone, this));
            this.$elm.append(this.$done);
            this.$btn = $('#button');
            this.$btn.click($.proxy(this.handleClick, this));
            this.selected = [];
        },
        handleClick: function() {
            this.$elm.show();
        },
        handleDone: function() {
            this.$elm.hide();
        },
        handleSelect: function(date) {
            var index = $.inArray(date, this.selected);
            if(index == -1) {
                this.selected.push(date);
                dates.push(date);
            } else {
                delete this.selected[index];
                delete dates[index];
            }
        },
        beforeShowDay: function(date) {
            var theday = date.getFullYear() + '/' +
                pad2(date.getMonth()+1)+'/'+
                pad2(date.getDate());
 
            return [true, $.inArray(theday, this.selected)>=0? 'selected':''];
        }
    };
 
    // Export
    ns.addMonth = addMonth;
 
})(jQuery, document, PRJ);
 
$(function() {
    PRJ.addMonth.initialize();
});
</script>
